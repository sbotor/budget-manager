{% extends 'budget/base.html' %}
{% load crispy_forms_filters %}

{% block title %}Operation history{% endblock %}

{% block content %}
<h3>History of Your operations</h3>
<div class="container">
    <table class="table">
        <thead>
            <tr>
            <th scope="col">#</th>
            <th scope="col">Amount</th>
            <th scope="col">Label</th>
            <th scope="col">Created</th>
            <th scope="col">Finalized</th>
            <th scope="col"></th>
            </tr>
        </thead>
        <tbody>
            {%for op in operations reversed %}
            <tr>
                <th scope="row">{{ forloop.counter }}</th>

                <td>{{ op.amount }}</td>    <!-- Amount -->

                <!-- Label -->
                <td>{{ op.label|default:'-' }}</td>

                <td>{{ op.creation_datetime }}</td> <!-- Created -->

                <td>  <!-- Finalized -->
                    {% if op.final_datetime %}
                    {{ op.final_datetime }}
                    {% else %}
                    <div class="col-1">
                        <button type="submit" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#finalizeOperation{{ forloop.counter }}">Finalize</button>
                    </div>
                    <form method="POST" class="mt-3"> {% csrf_token %}
                        <div class="modal fade" id="finalizeOperation{{ forloop.counter }}" data-bs-backdrop="static" data-bs-keyboard="false"
                        tab-index="-1" aria-labelledby="finalizeOperationLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="finalizeOperationLabel">Confirmation</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        Do you want to finalize this operation?<br>
                                        Amount: {{ op.amount }}<br>
                                        Created: {{ op.creation_datetime }}
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cancel</button>
                                        <button type="submit" class="btn btn-secondary" name="fin_id" value="{{ op.id }}">Finalize</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    {%endif%}
                </td>
                
                <td> <!-- Remove button -->
                    <div class="col-1">
                        <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#removeOperation{{ forloop.counter }}">Remove</button> 
                    </div>
                    <form method="POST" class="mt-3"> {% csrf_token %}
                        <div class="modal fade" id="removeOperation{{ forloop.counter }}" data-bs-backdrop="static" data-bs-keyboard="false"
                        tab-index="-1" aria-labelledby="removeOperationLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="removeOperationLabel">Confirmation</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        Do you really want to remove this operation?<br>
                                        Amount: {{ op.amount }}<br>
                                        Created: {{ op.creation_datetime }}
                                        {% if op.final_datetime %} <br> Finalized: {{ op.final_datetime }} {% endif %}
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cancel</button>
                                        <button type="submit" class="btn btn-danger" name="rm_id" value="{{ op.id }}">Remove</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </td>

            </tr>
            {%endfor%}
        </tbody>
    </table>
</div>
{% endblock %}